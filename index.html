<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Auto-Shooter – Diagnose</title>
  <style>
    html,body{margin:0;height:100%;background:#0b0f1a;color:#e6edf3;font-family:system-ui}
    #log{position:fixed;left:8px;right:8px;bottom:8px;max-height:40vh;overflow:auto;background:rgba(0,0,0,.5);padding:8px;border-radius:8px;font-size:12px;white-space:pre-wrap}
    canvas{display:block;width:100vw;height:100vh;touch-action:none}
  </style>
</head>
<body>
<canvas id="game"></canvas>
<pre id="log">Lade…</pre>
<script>
(function(){
  const logEl = document.getElementById('log');
  function log(msg){ logEl.textContent += '\\n' + msg; }
  window.onerror = (m, s, l, c, e) => { log('Error: ' + m + ' @ ' + s + ':' + l); };
  window.onunhandledrejection = (ev) => { log('Promise error: ' + (ev.reason && ev.reason.stack || ev.reason)); };

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(regs=>{
      if(regs.length){ regs.forEach(r=>r.unregister()); log('Service Worker deaktiviert (Diagnose-Modus).'); }
    });
  }

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  function resize(){
    const DPR = window.devicePixelRatio || 1;
    canvas.width  = Math.max(320, Math.floor(window.innerWidth * DPR));
    canvas.height = Math.max(480, Math.floor(window.innerHeight * DPR));
    canvas.style.width  = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
  }
  window.addEventListener('resize', resize, {passive:true});
  resize();

  // Sichtbarer Render-Test
  function drawBG(){
    const W = canvas.width, H = canvas.height;
    ctx.fillStyle = '#0b0f1a';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = 'rgba(89,241,200,.25)';
    ctx.fillRect(0, H*0.7, W, H*0.3);
    ctx.fillStyle = '#e6edf3';
    ctx.fillText('Diagnose-Build läuft. Wenn du das siehst, rendert Canvas.', 16, 28);
  }

  let last = 0;
  function loop(t){
    if(!last) last = t;
    drawBG();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
  log('Diagnose-Loop gestartet. Wenn die Seite trotzdem leer ist, ist vermutlich das CSS/DOM blockiert.');

})();
</script>
</body>
</html>
